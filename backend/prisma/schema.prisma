// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// Users in the system.
/// For KillSwitch, this represents the founder's customers / accounts being controlled.
model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  isAdmin      Boolean  @default(false)

  /// Access-state flags controlled by KillSwitch
  hasAccess Boolean @default(true)   // "Should this user generally have access?"
  isFrozen  Boolean @default(false)  // Per-user kill switch

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

/// Immutable log of all security-critical actions.
model SecurityEvent {
  id        String           @id @default(cuid())
  createdAt DateTime         @default(now())
  type      SecurityEventType
  userId    String?          // optional: which user this event is about
  reason    String?          // human-readable reason
  metadata  Json?            // extra context (globalLock flag, actor label, etc.)
}

/// Singleton system state row controlling the global kill switch.
model SystemState {
  id            Int      @id
  globalLock    Boolean  @default(false)
  lastChangedAt DateTime @default(now())
}

enum SecurityEventType {
  ACCESS_DENIED
  GLOBAL_LOCK_CHANGED
  USER_FROZEN
  USER_UNFROZEN
}



